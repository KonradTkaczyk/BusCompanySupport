<h1>Listing all available tickets</h1>
<%= form_tag(tickets_path, :method => 'get') do %>
  <div class="field">
    Select city from trip begins:<br />
    <%= collection_select :ticket, :cityFrom, Ticket.find(:all, :select => "DISTINCT cityFrom", :order => "cityFrom"),:cityFrom,:cityFrom,{},{:onchange=>"jumpTo();"} %>
  </div>
  <div class="field">
    Select city in which trip ends:<br />
    <%= collection_select :ticket, :cityTo, Ticket.find(:all, :select => "DISTINCT cityTo", :order => "cityTo"),:cityTo,:cityTo,{},{:onchange=>"jumpTo();"} %>
  </div>
  <div class="actions">
    <%= submit_tag "Search", :name => nil %>
  </div>
<% end %>

<!DOCTYPE html>
<html>
  <head>
    <script src="http://openlayers.org/api/OpenLayers.js" type=text/javascript></script>
    <script type="text/javascript">
        var map, baseLayer, markers;
        function init()
        {
          map = new OpenLayers.Map('map');
          baseLayer = new OpenLayers.Layer.OSM();
          map.addLayer(baseLayer);
          var fromProjection = new OpenLayers.Projection("EPSG:4326");   // Transform from WGS 1984
          var toProjection   = new OpenLayers.Projection("EPSG:900913"); // to Spherical Mercator Projection
          var position = new OpenLayers.LonLat(19.00,52.00).transform( fromProjection, toProjection)
          map.setCenter(position,6);
          markers = new OpenLayers.Layer.Markers("Cities");
          map.addLayer(markers);
        }

        function jumpTo()
        {
          var fromProjection = new OpenLayers.Projection("EPSG:4326");   // Transform from WGS 1984
          var toProjection   = new OpenLayers.Projection("EPSG:900913"); // to Spherical Mercator Projection
          var cities = new Object();
          cities['Radom'] = "21.15, 51.40";
          cities['Gdansk'] = "18.633333,54.366667";
          cities['Olsztyn'] = "20.55,53.783333";
          cities['Szczecin'] = "14.542222, 53.438056";
          cities['Ciechanow'] = "20.608056,52.876111";
          cities['Warsaw'] = "21.008333, 52.232222";
          markers.clearMarkers();
          var selectBox = document.getElementById('ticket_cityFrom');
   	      if (selectBox.value == "NA") return;
   	      var locationPlace = cities[selectBox.value]
   	      var parse = locationPlace.split(',');
   	      var location = new OpenLayers.LonLat(parse[0],parse[1]).transform( fromProjection, toProjection);
   	      var size = new OpenLayers.Size(21,25);
          var offset = new OpenLayers.Pixel(-(size.w/2), -size.h);
          var icon = new OpenLayers.Icon('http://www.openlayers.org/dev/img/marker.png',size,offset);
          markers.addMarker(new OpenLayers.Marker(location,icon.clone()));
          selectBox = document.getElementById('ticket_cityTo');
   	      if (selectBox.value == "NA") return;
   	      locationPlace = cities[selectBox.value]
   	      parse = locationPlace.split(',');
   	      location = new OpenLayers.LonLat(parse[0],parse[1]).transform( fromProjection, toProjection);
   	      size = new OpenLayers.Size(21,25);
          offset = new OpenLayers.Pixel(-(size.w/2), -size.h);
          icon = new OpenLayers.Icon('http://www.openlayers.org/dev/img/marker.png',size,offset);
          markers.addMarker(new OpenLayers.Marker(location,icon.clone()));
        }
    </script>
  </head>
  <body onload="init()">
    <h1>OpenLayers Tutorial - Place a Marker</h1>
    <div id="map"></div>
    <br />
  </body>
</html>

<%= render 'index' %>
<table>
  <th><% if current_user.admin? %>
    <%= link_to 'New Ticket', new_ticket_path %>
  <% end %></th>
  <th><%= link_to 'Back', root_path %></th>
</table>

